"use strict";angular.module("sbAdminApp").controller("flagCtrl",function($scope,$position,$http,$interval){function getBlacklistedCodes(skipValue){$scope.code=[],$http.post("api/blacklisted/shortcodes/"+skipValue,{}).then(function(response){$scope.blacklistedShortCodes=response.data.data.data,$scope.length=response.data.data.count})}$scope.alerts=[],$scope.closeAlert=function(index){$scope.alerts.splice(index,1)},$http.get("api/flaged/data").then(function(response){$scope.blacklistData=response.data.data},function(response){$scope.alerts=[{msg:response.data.userMessage||"Server error! Are you connected to the internet?.",type:"error"}]}),$scope.smsIndex=function(reg){if(-1!==$scope.blacklistData.indexOf(reg)){var index=$scope.blacklistData.indexOf(reg),sms=$scope.blacklistData[index];$scope.undoMsg(sms),$scope.blacklistData.splice(index,1)}else if(-1!==$scope.dataSmsText.indexOf(reg)){var ind=$scope.dataSmsText.indexOf(reg),sms1=$scope.dataSmsText[ind];$scope.undoMsg(sms1),$scope.dataSmsText.splice(ind,1)}},$scope.undoMsg=function(sms){$http.post("api/delete/flag",{address:sms.address,msg:sms.msg}).then(function(response){$scope.alerts=[{msg:response.data.userMessage,type:"info"}]},function(response){$scope.alerts=[{msg:response.data.userMessage||"Server error! Are you connected to the internet?.",type:"error"}]})},$scope.codeIndex=function(code){if(-1!==$scope.blacklistedShortCodes.indexOf(code)){var index=$scope.blacklistedShortCodes.indexOf(code),shortcode=$scope.blacklistedShortCodes[index];$scope.undoCode(shortcode),$scope.blacklistedShortCodes.splice(index,1)}else if(-1!==$scope.dataSmsCode.indexOf(code)){var ind=$scope.dataSmsCode.indexOf(code),code1=$scope.dataSmsCode[ind];$scope.undoCode(code1),$scope.dataSmsCode.splice(ind,1)}},$scope.undoCode=function(shortcode){$http.post("api/delete/flag",{address:shortcode.Sender,_id:shortcode._id}).then(function(response){$scope.alerts=[{msg:response.data.userMessage,type:"info"}],$scope.length--},function(response){$scope.alerts=[{msg:response.userMessage||"Server error! Are you connected to the internet?.",type:"error"}]})},$scope.dataSmsCode=[],$scope.dataSmsText=[],$scope.showMatchedData=!1,$scope.autoData=function(){""===$scope.autodata?$scope.showMatchedData=!1:($scope.showMatchedData=!0,$http.post("api/Autocorrect/BlackListed",{text:$scope.autodata}).then(function(response){$scope.msg=response.data.userMessage,$scope.dataSmsCode=response.data.data.dataSmsCode,$scope.dataSmsText=response.data.data.dataSmsText},function(response){$scope.alerts=[{msg:response.data.userMessage||"Server error! Are you connected to the internet?.",type:"error"}]}))},$scope.sortBy=function(sortValue){$scope.sort=sortValue},$scope.order="address",$scope.orderBy=function(sortValue){$scope.order=sortValue},$scope.skipValue=0,getBlacklistedCodes(0),$scope.previous=function(){$scope.skipValue<0||($scope.skipValue--,getBlacklistedCodes($scope.skipValue))},$scope.next=function(){$scope.skipValue++,getBlacklistedCodes($scope.skipValue)},$scope.currentPage=1,$scope.pageSize=10});