"use strict";angular.module("sbAdminApp").controller("merchantsCtrl",function($scope,$http,DTOptionsBuilder,DTColumnBuilder,$compile,$filter,api){function toggleAll(selectAll,selectedItems){for(var id in selectedItems)selectedItems.hasOwnProperty(id)&&(selectedItems[id]=selectAll)}function toggleOne(selectedItems){for(var id in selectedItems)if($scope.selectedMerchants.push(id),selectedItems.hasOwnProperty(id)&&!selectedItems[id])return void($scope.selectAll=!1);$scope.selectAll=!0}var url=api.addr();$http({method:"GET",url:url+"get-categories"}).then(function(response){var cats=response.data.list;return $scope.categories=cats,cats},function(response){console.log("Oops, Somethings went wrong.")}),$scope.selected={},$scope.selectAll=!1,$scope.toggleAll=toggleAll,$scope.toggleOne=toggleOne,$scope.selectedMerchants=[],$scope.alert="";var chkbox_checked=$('input[name="chk[]"]:checked').length;document.getElementsByClassName("multi-check");0===chkbox_checked&&($scope.selectAll=!1),console.log(chkbox_checked);var titleHtml='<input ng-model="selectAll" ng-click="toggleAll(selectAll, selected)" type="checkbox">';$scope.dtOptions=DTOptionsBuilder.newOptions().withOption("ajax",{url:url+"get-merchants",type:"POST"}).withDataProp("data").withOption("processing",!0).withOption("serverSide",!0).withOption("createdRow",function(row,data,dataIndex){$compile(angular.element(row).contents())($scope)}).withOption("headerCallback",function(header){$scope.headerCompiled||($scope.headerCompiled=!0,$compile(angular.element(header).contents())($scope))}),$scope.dtColumns=[DTColumnBuilder.newColumn("name").withTitle("Merchant"),DTColumnBuilder.newColumn("Type").withTitle("Type"),DTColumnBuilder.newColumn("dateCreated").withTitle("Created").renderWith(function(data,type,full){return $filter("date")(data,"medium")}),DTColumnBuilder.newColumn("dateModified").withTitle("Updated").renderWith(function(data,type,full){return $filter("date")(data,"medium")}),DTColumnBuilder.newColumn("icon").notVisible(),DTColumnBuilder.newColumn("imageUrl").notVisible(),DTColumnBuilder.newColumn(null).withTitle("Category").notSortable().renderWith(function(data,type,full,meta){return data.icon?'<img ng-src="'+data.icon+'" height="70" width="80" alt=""/>':'<img ng-src="'+data.imageUrl+'" height="70" width="80" alt=""/>'}),DTColumnBuilder.newColumn(null).withTitle(titleHtml).notSortable().renderWith(function(data,type,full,meta){$scope.selected[full._id]=!1;var merchant_id=JSON.stringify(data._id);return"<input ng-model='selected["+merchant_id+"]' name=chk[] class='multi-check' ng-click='toggleOne(selected)' type='checkbox'>"})],$scope.changeMerchantCategory=function(){var category=$scope.merchantdata.category,allMerchants=$scope.selected,merchants=[];angular.forEach(allMerchants,function(value,merchant_id){value&&this.push(merchant_id)},merchants);var req={method:"POST",url:url+"update-merchant-category",data:{merchants:merchants,category:category}};$http(req).then(function(response){$scope.alert=response.data.Success,console.log(response.data.Success)},function(response){console.log(response)})}});