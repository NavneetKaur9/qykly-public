"use strict";angular.module("sbAdminApp",["angularUtils.directives.dirPagination"]).controller("notificationCtrl",function($scope,$http,api,$cookieStore,DTOptionsBuilder,DTColumnBuilder,$filter,$window,$compile){var token=$cookieStore.get("c2cCookie"),url=api.addr();$scope.assignedTexts=[],$scope.pageno=1,$scope.total_count=0,$scope.itemsPerPage=100,$scope.currentPage=1,$scope.assignedTextsList=function(pageno){angular.isUndefined($scope.searchStr)?"":$scope.searchStr;$scope.assignedTexts=[];var req={method:"get",url:url+"get-assigned-msgs/"+$scope.itemsPerPage+"/"+pageno,headers:{Authorization:$cookieStore.get("c2cCookie")}};$http(req).success(function(response){$scope.assignedTexts=response.data,$scope.total_count=response.total_count,$scope.assignedTexts.length>0&&$("tbody").find("td.anchor_xeditable").each(function(index){var anchor=$(this).children("a");$(anchor).click(function(){var btn=$(this).closest("td").find("button.btn-primary"),frm=$(this).closest("td").children("form");$(btn).click(function(){var selectedStatus=$(".editable-has-buttons option:selected").text(),text=$scope.assignedTexts[index]._id,req={method:"POST",url:url+"updateProcessingStatus",data:{selectedStatus:selectedStatus,text:text,token:token}};$http(req).then(function(response){response.data&&index!==-1&&($scope.assignedTexts.splice(index,1),$(frm).hide(),$(anchor).removeClass("editable-hide"),$(anchor).removeClass("editable-empty"),$(anchor).text(selectedStatus))},function(response){console.log(response)})})})})}),$scope.currentPage=pageno},$scope.assignedTextsList($scope.pageno),$scope.sortType="saveTime",$scope.sortReverse=!1,$scope.order=function(sortType){$scope.sortReverse=$scope.sortType===sortType&&!$scope.sortReverse,$scope.sortType=sortType},$scope.parse=function(sms){api.post("parsemessage",!1,token,{message:sms.text,shortcode:sms.address},function(err,response){err?$scope.alert=response.message:$scope.alert=response.count+" message parsesd with "+response.shortcode})},$scope.statuses=[{value:"Pending",text:"Pending"},{value:"Complete",text:"Complete"},{value:"Exists",text:"Exists"}],$scope.showSelected=function(selectedStatus){$scope.selectedOption=selectedStatus},$scope.removeAssignedMessages=function(text,index){var req={method:"POST",url:url+"updateProcessingStatus",data:{selectedStatus:"Promotional",text:text,token:token}};$http(req).then(function(response){response.data&&index!==-1&&$scope.assignedTexts.splice(index,1)},function(response){console.log(response)})}});