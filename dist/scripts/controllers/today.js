"use strict";angular.module("sbAdminApp").controller("todayCtrl",function($scope,$http,api,$cookieStore){var token=(api.addr(),$cookieStore.get("c2cCookie"));$scope.closeAlert=function(){$scope.alert=!1};var page=0;$scope.getTodaysUser=function(){$scope.showProcessing=!0,api.get("todays-users",!1,token,{page:page},function(err,response){err?$scope.alert=response.message:($scope.appUsers=response.result,$scope.showProcessing=!1)})},$scope.moreUsers=function(){page++,$scope.getTodaysUser()};var d=new Date;d.setHours(0,0,0,0);var time=+d;$scope.unProc={codes:[],start:0,sortby:"count",searchCode:"",getcodes:function(){1==$scope.currentPage&&($scope.showLoader=!0),$scope.currentPage>1&&($scope.showLoaderUnProc=!0),api.get("get-unprocessedCodes-today",!1,token,{start:$scope.currentPage,search:$scope.unProc.searchCode,sortby:$scope.unProc.sortby,time:time},function(err,response){err||response.error?$scope.alert=response.userMessage||"Server error! Are you connected to the internet?.":($scope.showLoader=!1,$scope.showLoaderUnProc=!1,$scope.unProc.codes=response.data,$scope.totalItems=response.totalcount)})},search:function(){$scope.unProc.codes=[],$scope.unProc.start=0,$scope.unProc.getcodes()},showMore:function(){$scope.unProc.start++,$scope.unProc.getcodes()},sort:function(){$scope.unProc.codes=[],$scope.unProc.sortby=$scope.unProc.sortby,$scope.unProc.start=0,$scope.unProc.getcodes()}},$scope["new"]={codes:[],start:0,sortby:"count",searchCode:"",getcodes:function(){1==$scope.currentPage&&($scope.showLoader=!0),$scope.currentPage>1&&($scope.showLoaderNew=!0),api.get("get-newCodes-today",!1,token,{start:$scope.currentPage,search:$scope["new"].searchCode,sortby:$scope["new"].sortby,time:time},function(err,response){err||response.error?$scope.alert=response.userMessage||"Server error! Are you connected to the internet?.":($scope.showLoader=!1,$scope.showLoaderNew=!1,$scope["new"].codes=response.data,$scope.totalItems=response.totalcount)})},search:function(){$scope["new"].codes=[],$scope["new"].start=0,$scope["new"].getcodes()},showMore:function(){$scope["new"].start++,$scope["new"].getcodes()},sort:function(){$scope["new"].codes=[],$scope["new"].sortby=$scope["new"].sortby,$scope["new"].start=0,$scope["new"].getcodes()}},$scope.proc={codes:[],start:0,sortby:"count",searchCode:"",getcodes:function(){1==$scope.currentPage&&($scope.showLoader=!0),$scope.currentPage>1&&($scope.showLoaderProc=!0),api.get("get-processedCodes-today",!1,token,{start:$scope.currentPage,search:$scope.proc.searchCode,sortby:$scope.proc.sortby,time:time},function(err,response){err||response.error?$scope.alert=response.userMessage||"Server error! Are you connected to the internet?.":($scope.showLoader=!1,$scope.showLoaderProc=!1,$scope.proc.codes=response.data,$scope.totalItems=response.totalcount)})},search:function(){$scope.proc.codes=[],$scope.proc.start=0,$scope.proc.getcodes()},showMore:function(){$scope.proc.start++,$scope.proc.getcodes()},sort:function(){$scope.proc.codes=[],$scope.proc.sortby=$scope.proc.sortby,$scope.proc.start=0,$scope.proc.getcodes()}},$scope.start=1,$scope.currentPage=1,$scope.length=10,$scope.itemsPerPage=50,$scope.getSms=function(code,status,start,tab){code!==$scope.code&&($scope.currentPage=1),$scope.activeMenu=code,$scope.showLoaderMessages=!0,$scope.loadingMsg=!0,$scope.selected_all=!1,$scope.code=code,api.get("get-messages-today",!1,token,{address:code,status:status,start:start,length:50,time:time},function(err,response){err||response.error?$scope.alert=response.userMessage||"Server error! Are you connected to the internet?.":($scope.messages=response.data,$scope.status=status,$scope.tab=tab,$scope.totalCount=response.totalCount,$scope.loadingMsg=!1,$scope.showLoaderMessages=!1)})},$scope.pageChanged=function(newPage){$scope.selected_all=!1,$scope.unProc.getcodes()},$scope.pageChangedProc=function(newPage){$scope.proc.getcodes()},$scope.pageChangedNew=function(newPage){$scope["new"].getcodes()},$scope.assign=function(){$scope.msgText=[];for(var checkboxes=document.getElementsByName("assign"),i=0;i<checkboxes.length;i++)if(checkboxes[i].checked){var value=checkboxes[i].value;$scope.msgText.push(value)}api.put("assign-msg",!1,token,{msgText:$scope.msgText,assignTo:$scope.assignTo.name},function(err,response){err||response.error?$scope.alert=response.message:($scope.alert=response.message,$scope.getSms($scope.code,$scope.status,$scope.start,$scope.tab))})},$scope.moveToDump=function(){$scope.msgText=[];for(var checkboxes=document.getElementsByName("assign"),i=0;i<checkboxes.length;i++)if(checkboxes[i].checked){var value=checkboxes[i].value;$scope.msgText.push(value)}api.put("move-to-dumb",!1,token,{msgText:$scope.msgText},function(err,response){err||response.error?$scope.alert=response.message:($scope.alert=response.message,$scope.getSms($scope.code,$scope.status,$scope.start,$scope.tab))})},$scope.useLater=function(){$scope.addresses=[];for(var checkboxes=document.getElementsByName("blacklist"),i=0;i<checkboxes.length;i++)if(checkboxes[i].checked){var value=checkboxes[i].value;$scope.addresses.push(value)}api.put("later-use",!1,token,{shortcode:$scope.addresses},function(err,response){err||response.error?$scope.alerts=[{msg:response.userMessage||"Server error! Are you connected to the internet?.",type:"error"}]:($scope.alert=response.message,$scope["new"].messages=[],$scope["new"].codes=[],$scope["new"].getcodes())})},$scope.blacklist=function(){$scope.addresses=[];for(var checkboxes=document.getElementsByName("blacklist"),i=0;i<checkboxes.length;i++)if(checkboxes[i].checked){var value=checkboxes[i].value;$scope.addresses.push(value)}api.put("blacklist",!1,token,{address:$scope.addresses},function(err,response){err||response.error?$scope.alerts=[{msg:response.userMessage||"Server error! Are you connected to the internet?.",type:"error"}]:($scope.alert=response.message,$scope["new"].messages=[],$scope["new"].codes=[],$scope["new"].getcodes())})},$scope.Users={users:[],getusers:function(time){$scope.showLoader=!0,api.get("emails-todays-users",!1,token,{start:$scope.currentPage,filter:time},function(err,response){err||response.error?$scope.alert=response.userMessage||"Server error! Are you connected to the internet?.":($scope.showLoader=!1,$scope.Users.users=response.data,$scope.totalItems=response.length)})}},$scope.email="",$scope.getCount=function(userEmail){$scope.msgCount=null,$scope.email=userEmail,$scope.alert="loading............",$scope.loadingMsg=!0,api.get("user-info-by-email/"+userEmail,!1,token,{},function(err,response){err||response.error?$scope.alert=response.userMessage||"Server error! Are you connected to the internet?.":($scope.msgCount=response.data,$scope.loadingMsg=!1,$scope.alert=!1)})},$scope.getUsers=function(time,page){$scope.msgCount=null,$scope.proc.codes=[],$scope.unProc.codes=[],$scope["new"].codes=[],$scope.todayusers=[],$scope.weekusers=[],$scope.yesterdayusers=[],$scope.currentPage=page,1==$scope.currentPage&&($scope.showLoader=!0),$scope.currentPage>1&&($scope.showPageLoader=!0),api.get("emails-todays-users",!1,token,{start:page,filter:time},function(err,response){err||response.error?$scope.alert=response.userMessage||"Server error! Are you connected to the internet?.":($scope.showLoader=!1,"today"==time?$scope.todayusers=response.data:"yesterday"==time?$scope.yesterdayusers=response.data:"week"==time&&($scope.weekusers=response.data),$scope.totalItems=response.length,$scope.showPageLoader=!1)})},$scope.pageChangedUsers=function(newPage,time){$scope.getUsers(time,newPage)},$scope.getShortcodes=function(value){$scope.yesterdayusers=[],$scope.todayusers=[],$scope.weekusers=[],$scope.proc.codes=[],$scope.unProc.codes=[],$scope["new"].codes=[],$scope.currentPage=1,$scope.msgCount=null,"new"===value?$scope["new"].getcodes():"proc"===value?$scope.proc.getcodes():"unProc"===value&&$scope.unProc.getcodes()},$scope.showCounts=function(){$scope.alert="loading............",$scope.loadingMsg=!0,api.get("todayscount/",!1,token,{},function(err,response){err||response.error?$scope.alert=response.userMessage||"Server error! Are you connected to the internet?.":($scope.allCounts=response,$scope.loadingMsg=!1,$scope.alert=!1)})},$scope.showCounts()});