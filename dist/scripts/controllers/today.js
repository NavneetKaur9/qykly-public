"use strict";angular.module("sbAdminApp").controller("todayCtrl",function($scope,$http,api,$cookieStore){var token=(api.addr(),$cookieStore.get("c2cCookie"));$scope.closeAlert=function(){$scope.alert=!1};var page=0;$scope.getTodaysUser=function(){$scope.showProcessing=!0,api.get("todays-users",!1,token,{page:page},function(err,response){err?$scope.alert=response.message:($scope.appUsers=response.result,$scope.showProcessing=!1)})},$scope.getTodaysUser(),$scope.moreUsers=function(){page++,$scope.getTodaysUser()};var d=new Date;d.setHours(0,0,0,0);var time=+d;$scope.unProc={codes:[],start:0,sortby:"count",searchCode:"",getcodes:function(){$scope.showLoaderunProc=!0,console.log("get codes00"),api.get("get-unprocessedCodes-today",!1,token,{start:$scope.unProc.start,search:$scope.unProc.searchCode,sortby:$scope.unProc.sortby,time:time},function(err,response){err||response.error?$scope.alert=response.userMessage||"Server error! Are you connected to the internet?.":($scope.showLoaderunProc=!1,$scope.unProc.codes=$scope.unProc.codes.concat(response))})},search:function(){$scope.unProc.codes=[],$scope.unProc.start=0,$scope.unProc.getcodes()},showMore:function(){$scope.unProc.start++,$scope.unProc.getcodes()},sort:function(){$scope.unProc.codes=[],$scope.unProc.sortby=$scope.unProc.sortby,$scope.unProc.start=0,$scope.unProc.getcodes()}},$scope.unProc.getcodes(),$scope["new"]={codes:[],start:0,sortby:"count",searchCode:"",getcodes:function(){$scope.showLoaderNew=!0,api.get("get-newCodes-today",!1,token,{start:$scope["new"].start,search:$scope["new"].searchCode,sortby:$scope["new"].sortby,time:time},function(err,response){err||response.error?$scope.alert=response.userMessage||"Server error! Are you connected to the internet?.":($scope.showLoaderNew=!1,$scope["new"].codes=$scope["new"].codes.concat(response))})},search:function(){$scope["new"].codes=[],$scope["new"].start=0,$scope["new"].getcodes()},showMore:function(){$scope["new"].start++,$scope["new"].getcodes()},sort:function(){$scope["new"].codes=[],$scope["new"].sortby=$scope["new"].sortby,$scope["new"].start=0,$scope["new"].getcodes()}},$scope["new"].getcodes(),$scope.proc={codes:[],start:0,sortby:"count",searchCode:"",getcodes:function(){$scope.showLoaderProc=!0,api.get("get-processedCodes-today",!1,token,{start:$scope.proc.start,search:$scope.proc.searchCode,sortby:$scope.proc.sortby,time:time},function(err,response){err||response.error?$scope.alert=response.userMessage||"Server error! Are you connected to the internet?.":($scope.showLoaderProc=!1,$scope.proc.codes=$scope.proc.codes.concat(response))})},search:function(){$scope.proc.codes=[],$scope.proc.start=0,$scope.proc.getcodes()},showMore:function(){$scope.proc.start++,$scope.proc.getcodes()},sort:function(){$scope.proc.codes=[],$scope.proc.sortby=$scope.proc.sortby,$scope.proc.start=0,$scope.proc.getcodes()}},$scope.proc.getcodes(),$scope.start=1,$scope.currentPage=1,$scope.length=10,$scope.itemsPerPage=50,$scope.getSms=function(code,status,start,tab){code!==$scope.code&&($scope.currentPage=1),$scope.activeMenu=code,$scope.showLoaderMessages=!0,$scope.loadingMsg=!0,$scope.selected_all=!1,$scope.code=code,api.get("get-messages-today",!1,token,{address:code,status:status,start:start,length:50,time:time},function(err,response){err||response.error?$scope.alert=response.userMessage||"Server error! Are you connected to the internet?.":($scope.messages=response.data,$scope.status=status,$scope.tab=tab,$scope.totalCount=response.totalCount,$scope.loadingMsg=!1,$scope.showLoaderMessages=!1)})},$scope.pageChanged=function(newPage){$scope.selected_all=!1,console.log($scope.code,$scope.status,newPage),$scope.getSms($scope.code,$scope.status,newPage,$scope.tab)},$scope.assign=function(){$scope.msgText=[];for(var checkboxes=document.getElementsByName("assign"),i=0;i<checkboxes.length;i++)if(checkboxes[i].checked){var value=checkboxes[i].value;$scope.msgText.push(value)}api.put("assign-msg",!1,token,{msgText:$scope.msgText,assignTo:$scope.assignTo.name},function(err,response){err||response.error?$scope.alert=response.message:($scope.alert=response.message,$scope.getSms($scope.code,$scope.status,$scope.start,$scope.tab))})},$scope.moveToDump=function(){$scope.msgText=[];for(var checkboxes=document.getElementsByName("assign"),i=0;i<checkboxes.length;i++)if(checkboxes[i].checked){var value=checkboxes[i].value;$scope.msgText.push(value)}api.put("move-to-dumb",!1,token,{msgText:$scope.msgText},function(err,response){err||response.error?$scope.alert=response.message:($scope.alert=response.message,$scope.getSms($scope.code,$scope.status,$scope.start,$scope.tab))})},$scope.useLater=function(){$scope.addresses=[];for(var checkboxes=document.getElementsByName("blacklist"),i=0;i<checkboxes.length;i++)if(checkboxes[i].checked){var value=checkboxes[i].value;$scope.addresses.push(value)}api.put("later-use",!1,token,{shortcode:$scope.addresses},function(err,response){err||response.error?$scope.alerts=[{msg:response.userMessage||"Server error! Are you connected to the internet?.",type:"error"}]:($scope.alert=response.message,$scope["new"].messages=[],$scope["new"].codes=[],$scope["new"].getcodes())})},$scope.blacklist=function(){$scope.addresses=[];for(var checkboxes=document.getElementsByName("blacklist"),i=0;i<checkboxes.length;i++)if(checkboxes[i].checked){var value=checkboxes[i].value;$scope.addresses.push(value)}api.put("blacklist",!1,token,{address:$scope.addresses},function(err,response){err||response.error?$scope.alerts=[{msg:response.userMessage||"Server error! Are you connected to the internet?.",type:"error"}]:($scope.alert=response.message,$scope["new"].messages=[],$scope["new"].codes=[],$scope["new"].getcodes())})}});