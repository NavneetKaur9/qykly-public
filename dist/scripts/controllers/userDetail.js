"use strict";angular.module("sbAdminApp").controller("userDetailCtrl",function($scope,$http,$stateParams,api,DTOptionsBuilder,DTColumnBuilder,$filter,$window,$cookieStore){function getUser(){api.get("get-user",id,token,!1,function(err,response){err?$scope.alert=response.message:$scope.userData=response.userdata})}function getUserCount(){api.get("user-shortcode-count",!1,token,{id:id},function(err,response){err?$scope.alert=response.message:($scope.count1=response.unprocessed,$scope.count2=response["new"],$scope.count3=response.processed,$scope.count=!0)})}function getShortcode(codeType){$scope.showLoader=!0,api.get("get-users-shortcode",!1,token,{get_code_typ:codeType,id:id},function(err,response){err?$scope.alert=response.message:($scope.showLoader=!1,"new"===codeType?$scope["new"]=response:"proc"===codeType?$scope.proc=response:$scope.unproc=response)})}function countStatus(){api.get("get-sms-count-status",id,token,!1,function(err,response){if(err)$scope.alert=response.message;else{for(var i=0;i<response.length;i++)0===response[i].status?$scope.unproCount=response[i].count:3===response[i].status&&($scope.proCount=response[i].count);getUser()}})}var id=$stateParams.id,token=(api.addr(),$cookieStore.get("c2cCookie"));$window.scrollTo(0,0),$scope.code={},$scope.sms={},getUserCount(),getShortcode("unproc"),$scope.checkArray=[],$scope.check=function(value){var index=$scope.checkArray.indexOf(value);index===-1&&"new"===value?(getShortcode("new"),$scope.checkArray.push(value)):index===-1&&"proc"===value&&(getShortcode("proc"),$scope.checkArray.push(value))},countStatus(),$scope.getSms=function(code,status,codeType){$scope.selected_all=!1,$scope.alert="fetching "+code+" messages....",$scope.code=code,api.get("get-sms/"+id+"/"+status+"/"+code,!1,token,!1,function(err,response){err?$scope.alert=response.message:($scope.alert=!1,"new"===codeType?($scope.code_new=code,$scope.sms_new=response):"proc"===codeType?($scope.code_proc=code,$scope.sms_proc=response):"unproc"===codeType&&($scope.code_unproc=code,$scope.sms_unproc=response))})},$scope.blacklist=function(){for(var addresses=[],checkboxes=document.getElementsByName("blacklist"),i=0;i<checkboxes.length;i++)if(checkboxes[i].checked){var value=checkboxes[i].value;addresses.push(value)}api.put("blacklist",!1,token,{address:addresses},function(err,response){err?$scope.alert=response.message:($scope.alert=response.message,$scope.sms["new"]=[],getShortcode("new"),countStatus())})},$scope.closeAlert=function(){$scope.alert=!1},$scope.sortType="saveTime",$scope.sortReverse=!1,$scope.order=function(sortType){$scope.sortReverse=$scope.sortType===sortType&&!$scope.sortReverse,$scope.sortType=sortType},$scope.parseAllSms=function(){$scope.alert="  processing.........",api.post("parsesms",!1,token,{deviceId:id},function(err,response){if(err)$scope.alert=response.message;else if(0===response.output.length)return $scope.alert="No data found";$scope.parseSmsResult=response,$scope.alert=!1})},$scope.parseSms=function(code){$scope.parseSmsResult=[],$scope.alert="processing.........",api.post("parsesmsbyshortcode",!1,token,{shortcode:code},function(err,response){err?$scope.alert=response.message:0===response.output.length&&($scope.alert="No data found"),$scope.parseSmsResult=response,$scope.alert=!1})},$scope.closeParseSmsResult=function(argument){$scope.parseSmsResult=[]},$scope.assign=function(codeType){for(var msgText=[],checkboxes=document.getElementsByName("assign"),i=0;i<checkboxes.length;i++)if(checkboxes[i].checked){var value=checkboxes[i].value;msgText.push(value)}api.put("assign-msg",!1,token,{msgText:msgText,assignTo:$scope.assignTo.name},function(err,response){err||response.error?$scope.alert=response.message:($scope.alert=response.message,$scope.getSms($scope.code,0,codeType))})},api.get("user",!1,token,!1,function(err,response){err?$scope.alert=response.message:$scope.modusers=response}),$scope.moveToDump=function(){for(var msgText=[],checkboxes=document.getElementsByName("assign"),i=0;i<checkboxes.length;i++)if(checkboxes[i].checked){var value=checkboxes[i].value;msgText.push(value)}api.put("move-to-dumb",!1,token,{msgText:msgText},function(err,response){err||response.error?$scope.alert=response.message:($scope.alert=response.message,$scope.getSms($scope.code,0,"unproc"))})}});